<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WEXAUR Mini</title>
<meta name="theme-color" content="#0f6666">
<style>
  :root{
    --teal:#0F6666; --orange:#F68B1E; --lightgreen:#9ACD32; --purple:#7B3FA0;
    --bg:#ffffff; --card:#ffffff; --muted:#70757a; --border:#dfe1e5;
    font-family:Google Sans,Roboto,Arial,sans-serif;
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;background:var(--bg);color:#202124;padding:0}
  .wrap{max-width:100%;margin:0 auto}
  
  /* Header - Google Style */
  .header{display:flex;align-items:center;padding:14px 20px;gap:20px;border-bottom:1px solid #e8eaed}
  .logo{width:92px;height:30px;position:relative}
  .logo-text{
    font-weight:500;font-size:22px;letter-spacing:0.4px;
    background: linear-gradient(90deg, var(--teal), var(--orange), var(--lightgreen), var(--purple));
    -webkit-background-clip:text;background-clip:text;color:transparent;
    display:inline-block;
  }
  .nav-links{display:flex;gap:15px;margin-left:auto;align-items:center}
  .nav-link{color:#5f6368;text-decoration:none;font-size:14px}
  .nav-link:hover{color:#1a73e8}
  .apps-icon{color:#5f6368;font-size:20px;cursor:pointer;padding:8px}
  .apps-icon:hover{background:#f1f3f4;border-radius:50%}
  
  /* Main Content - Google Style */
  .main{display:flex;flex-direction:column;align-items:center;padding-top:120px}
  .logo-large{font-size:90px;font-weight:400;margin-bottom:20px}
  .logo-large span{display:inline-block}
  .logo-large .w{background:linear-gradient(90deg, var(--teal), var(--orange));-webkit-background-clip:text;background-clip:text;color:transparent}
  .logo-large .e{background:linear-gradient(90deg, var(--orange), var(--lightgreen));-webkit-background-clip:text;background-clip:text;color:transparent}
  .logo-large .x{background:linear-gradient(90deg, var(--lightgreen), var(--purple));-webkit-background-clip:text;background-clip:text;color:transparent}
  .logo-large .a{background:linear-gradient(90deg, var(--purple), var(--teal));-webkit-background-clip:text;background-clip:text;color:transparent}
  .logo-large .u{background:linear-gradient(90deg, var(--teal), var(--orange));-webkit-background-clip:text;background-clip:text;color:transparent}
  .logo-large .r{background:linear-gradient(90deg, var(--orange), var(--lightgreen));-webkit-background-clip:text;background-clip:text;color:transparent}
  
  /* Search Box - Google Style */
  .search-container{width:100%;max-width:584px;margin:0 auto;position:relative}
  .search-box{border:1px solid var(--border);border-radius:24px;height:44px;margin:0 auto;width:100%;display:flex;align-items:center;padding:5px 14px}
  .search-box:hover{box-shadow:0 1px 6px rgba(32,33,36,0.28);border-color:rgba(223,225,229,0)}
  .search-icon{color:#9aa0a6;margin-right:13px;display:flex;align-items:center}
  .search-input{flex:1;border:none;outline:none;font-size:16px;background:transparent}
  .voice-icon, .camera-icon{color:#4285f4;margin-left:10px;cursor:pointer;display:flex;align-items:center;padding:8px}
  .voice-icon:hover, .camera-icon:hover{background:#f1f3f4;border-radius:50%}
  
  /* Search Bar */
  .search-bar{display:flex;justify-content:center;margin-top:20px;border-bottom:1px solid #e8eaed;padding-bottom:12px}
  .search-option{color:#5f6368;font-size:14px;margin:0 12px;cursor:pointer;padding:8px 12px;border-radius:4px}
  .search-option:hover{color:#1a73e8;background:#f8f9fa}
  .search-option.active{color:#1a73e8;border-bottom:3px solid #1a73e8}
  
  /* Buttons - Google Style */
  .buttons{display:flex;justify-content:center;gap:12px;margin-top:28px}
  .search-btn, .lucky-btn{background-color:#f8f9fa;border:1px solid #f8f9fa;border-radius:4px;color:#3c4043;font-size:14px;padding:0 16px;height:36px;cursor:pointer}
  .search-btn:hover, .lucky-btn:hover{box-shadow:0 1px 1px rgba(0,0,0,0.1);background-color:#f8f9fa;border:1px solid #dadce0;color:#202124}
  
  /* Discover Section - Google Style */
  .discover-container{max-width:900px;margin:40px auto 0;padding:0 20px}
  .discover-title{font-size:18px;color:#3c4043;margin-bottom:16px;font-weight:500}
  .discover-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
  .discover-card{background:#ffffff;border:1px solid #e8eaed;border-radius:12px;padding:0;cursor:pointer;transition:all 0.2s;overflow:hidden;box-shadow:0 1px 2px rgba(0,0,0,0.05)}
  .discover-card:hover{box-shadow:0 2px 8px rgba(0,0,0,0.1);transform:translateY(-2px)}
  .discover-card-image{width:100%;height:140px;object-fit:cover;background:#f8f9fa}
  .discover-card-content{padding:12px 16px}
  .discover-card-title{font-weight:500;font-size:16px;color:#1a73e8;margin-bottom:6px}
  .discover-card-desc{font-size:14px;color:#5f6368;margin-bottom:8px;line-height:1.4}
  .discover-card-source{font-size:12px;color:#9aa0a6}
  
  /* Results Page */
  .results-header{display:flex;align-items:center;padding:14px 20px;border-bottom:1px solid #e8eaed}
  .results-logo{width:92px;height:30px}
  .search-box-results{max-width:692px;margin-left:40px;flex:1}
  .search-box-results .search-box{border-radius:8px;height:44px}
  .back-btn{background:none;border:none;color:#1a73e8;cursor:pointer;font-size:14px;padding:8px 12px;border-radius:4px;margin-right:15px}
  .back-btn:hover{background:#f1f3f4}
  
  /* Results Container */
  .results-container{max-width:652px;margin:0 auto;padding:20px}
  .results-info{color:#70757a;font-size:14px;margin-bottom:20px}
  .result-item{margin-bottom:26px}
  .result-url{color:#3c4043;font-size:14px;margin-bottom:4px}
  .result-title{color:#1a0dab;font-size:20px;text-decoration:none;margin-bottom:6px;display:block}
  .result-title:hover{text-decoration:underline}
  .result-snippet{color:#4d5156;font-size:14px;line-height:1.58}
  
  /* Pexels Images Grid */
  .images-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:16px;margin-top:20px}
  .image-card{border-radius:8px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.1);transition:transform 0.2s}
  .image-card:hover{transform:translateY(-4px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
  .image-card img{width:100%;height:200px;object-fit:cover;display:block}
  .image-info{padding:12px;background:white}
  .image-photographer{font-size:14px;color:#5f6368;margin-bottom:4px}
  .image-download{color:#1a73e8;font-size:13px;text-decoration:none;display:inline-block;margin-top:6px}
  .image-download:hover{text-decoration:underline}
  
  /* Festival Animations */
  .diwali-animation .logo-large span{animation:diwaliFlicker 2s infinite}
  .christmas-animation .logo-large span{animation:christmasGlow 2s infinite}
  .newyear-animation .logo-large span{animation:newyearSparkle 2s infinite}
  
  @keyframes diwaliFlicker {
    0%{filter:brightness(1) drop-shadow(0 0 5px rgba(255,165,0,0.7))}
    25%{filter:brightness(1.3) drop-shadow(0 0 10px rgba(255,215,0,0.9))}
    50%{filter:brightness(0.9) drop-shadow(0 0 7px rgba(255,140,0,0.8))}
    75%{filter:brightness(1.2) drop-shadow(0 0 12px rgba(255,255,0,0.9))}
    100%{filter:brightness(1) drop-shadow(0 0 5px rgba(255,165,0,0.7))}
  }
  
  @keyframes christmasGlow {
    0%{filter:brightness(1) drop-shadow(0 0 5px rgba(220,20,60,0.7))}
    33%{filter:brightness(1.2) drop-shadow(0 0 8px rgba(0,128,0,0.8))}
    66%{filter:brightness(1.1) drop-shadow(0 0 10px rgba(255,255,255,0.9))}
    100%{filter:brightness(1) drop-shadow(0 0 5px rgba(220,20,60,0.7))}
  }
  
  @keyframes newyearSparkle {
    0%{filter:brightness(1) drop-shadow(0 0 5px rgba(255,255,255,0.7))}
    50%{filter:brightness(1.4) drop-shadow(0 0 15px rgba(255,215,0,0.9))}
    100%{filter:brightness(1) drop-shadow(0 0 5px rgba(255,255,255,0.7))}
  }
  
  /* Hidden elements */
  .hidden{display:none}
  
  /* Menu Modal */
  .menu-modal{position:fixed;top:0;right:0;width:320px;height:100%;background:white;box-shadow:-2px 0 10px rgba(0,0,0,0.1);z-index:1000;padding:20px;overflow-y:auto;transform:translateX(100%);transition:transform 0.3s}
  .menu-modal.open{transform:translateX(0)}
  .menu-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:10px;border-bottom:1px solid #e8eaed}
  .menu-title{font-size:18px;font-weight:500}
  .menu-close{cursor:pointer;padding:8px}
  .menu-section{margin-bottom:24px}
  .menu-section-title{font-size:14px;color:#5f6368;margin-bottom:12px;text-transform:uppercase;font-weight:500}
  .menu-item{display:flex;align-items:center;padding:10px 0;cursor:pointer;border-radius:4px}
  .menu-item:hover{background:#f8f9fa}
  .menu-item-icon{margin-right:12px;color:#5f6368;width:20px;text-align:center}
  .menu-item-text{font-size:14px;color:#202124}
  .theme-options{display:flex;gap:10px;margin-top:8px}
  .theme-option{width:32px;height:32px;border-radius:50%;cursor:pointer;border:2px solid transparent}
  .theme-option.active{border-color:#1a73e8}
  .theme-light{background:#ffffff;border:1px solid #dadce0}
  .theme-dark{background:#202124}
  .theme-blue{background:#1a73e8}
  .theme-teal{background:#0F6666}
  
  /* Footer */
  .footer{background:#f2f2f2;padding:15px 20px;margin-top:auto}
  .footer-links{display:flex;justify-content:space-between;flex-wrap:wrap}
  .footer-link{color:#70757a;text-decoration:none;font-size:14px;margin-right:20px}
  .footer-link:hover{text-decoration:underline}
  
  /* Responsive */
  @media(max-width:760px){
    .main{padding-top:80px}
    .logo-large{font-size:60px}
    .search-container{max-width:90%}
    .discover-grid{grid-template-columns:1fr}
    .images-grid{grid-template-columns:repeat(2,1fr)}
    .footer-links{flex-direction:column;gap:10px}
    .search-bar{flex-wrap:wrap;gap:8px}
    .menu-modal{width:100%}
    .back-btn{margin-right:10px}
  }
  
  @media(max-width:480px){
    .images-grid{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <!-- Home Page -->
  <div id="homePage">
    <!-- Header -->
    <div class="header">
      <div class="logo">
        <div class="logo-text">WEXAUR Mini</div>
      </div>
      <div class="nav-links">
        <a href="#" class="nav-link">Images</a>
        <div class="apps-icon" id="menuToggle">☰</div>
      </div>
    </div>
    
    <!-- Search Bar -->
    <div class="search-bar">
      <div class="search-option active" data-type="web">All</div>
      <div class="search-option" data-type="images">Images</div>
      <div class="search-option" data-type="videos">Videos</div>
      <div class="search-option" data-type="news">News</div>
      <div class="search-option" data-type="maps">Maps</div>
    </div>
    
    <!-- Main Content -->
    <div class="main">
      <div class="logo-large" id="logoLarge">
        <span class="w">W</span>
        <span class="e">E</span>
        <span class="x">X</span>
        <span class="a">A</span>
        <span class="u">U</span>
        <span class="r">R</span>
      </div>
      
      <!-- Search Box -->
      <div class="search-container">
        <div class="search-box">
          <div class="search-icon">
            <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
              <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#9aa0a6"></path>
            </svg>
          </div>
          <input type="text" class="search-input" id="searchInput" placeholder="Search the web or type a URL">
          <div class="voice-icon" title="Search by voice" id="voiceSearch">
            <svg focusable="false" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
              <path fill="#0F6666" d="m12 15c1.66 0 3-1.31 3-2.97v-7.02c0-1.66-1.34-3.01-3-3.01s-3 1.34-3 3.01v7.02c0 1.66 1.34 2.97 3 2.97z"></path>
              <path fill="#0F6666" d="m11 18.08h2v3.92h-2z"></path>
              <path fill="#0F6666" d="m7.05 16.87c-1.27-1.33-2.05-2.83-2.05-4.87h2c0 1.45 0.56 2.42 1.47 3.38v0.32l-1.15 1.18z"></path>
              <path fill="#0F6666" d="m12 16.93a4.97 5.25 0 0 1 -3.54 -1.55l-1.41 1.49c1.26 1.34 3.02 2.13 4.95 2.13 3.87 0 6.99-2.92 6.99-7h-1.99c0 2.92-2.24 4.93-5 4.93z"></path>
            </svg>
          </div>
          <div class="camera-icon" title="Search by image" id="imageSearch">
            <svg focusable="false" viewBox="0 0 24 24" xmlns="http://www.w3.org2000/svg" width="24" height="24">
              <path fill="#0F6666" d="m14.13 17.46 2.66-4.62c.17-.29.05-.63-.25-.74-.1-.04-.21-.04-.31 0l-2.66 1.91-2.13-3.69c-.17-.29-.55-.38-.84-.21-.1.06-.17.15-.22.26l-2.37 4.11c-.17.29-.05.63.25.74.1.04.21.04.31 0l2.37-1.7 2.13 3.69c.17.29.55.38.84.21.1-.06.17-.15.22-.26z"></path>
              <circle cx="11.995" cy="12" fill="#0F6666" r="5.5"></circle>
              <path fill="#0F6666" d="m12 17.5c-3.04 0-5.5-2.46-5.5-5.5s2.46-5.5 5.5-5.5 5.5 2.46 5.5 5.5-2.46 5.5-5.5 5.5zm0-9c-1.93 0-3.5 1.57-3.5 3.5s1.57 3.5 3.5 3.5 3.5-1.57 3.5-3.5-1.57-3.5-3.5-3.5z"></path>
              <path fill="#0F6666" d="m3.5 7.5c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"></path>
              <path fill="#0F6666" d="m19.5 2.5h-15c-.83 0-1.5.67-1.5 1.5v15c0 .83.67 1.5 1.5 1.5h15c.83 0 1.5-.67 1.5-1.5v-15c0-.83-.67-1.5-1.5-1.5zm-15 17v-15h15l.0001 15h-15.0001z"></path>
            </svg>
          </div>
        </div>
      </div>
      
      <!-- Buttons -->
      <div class="buttons">
        <button class="search-btn" id="searchBtn">WEXAUR Search</button>
        <button class="lucky-btn">I'm Feeling Lucky</button>
      </div>
      
      <!-- Discover Section -->
      <div class="discover-container">
        <div class="discover-title">Today's Top Stories</div>
        <div class="discover-grid" id="discoverGrid">
          <!-- Filled by JavaScript -->
          <div class="discover-card">
            <div class="discover-card-image"></div>
            <div class="discover-card-content">
              <div class="discover-card-title">Loading Today's News...</div>
              <div class="discover-card-desc">Please wait while we load the latest stories</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
      <div class="footer-links">
        <div>
          <a href="#" class="footer-link">About WEXAUR</a>
          <a href="#" class="footer-link">Privacy</a>
          <a href="#" class="footer-link">Terms</a>
        </div>
        <div>
          <a href="#" class="footer-link">Settings</a>
          <a href="#" class="footer-link">Help</a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Results Page -->
  <div id="resultsPage" class="hidden">
    <!-- Header -->
    <div class="results-header">
      <button class="back-btn" id="backBtn">← Back</button>
      <div class="results-logo">
        <div class="logo-text">WEXAUR Mini</div>
      </div>
      <div class="search-box-results">
        <div class="search-box">
          <div class="search-icon">
            <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
              <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#9aa0a6"></path>
            </svg>
          </div>
          <input type="text" class="search-input" id="resultsSearchInput">
          <div class="voice-icon" title="Search by voice">
            <svg focusable="false" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
              <path fill="#0F6666" d="m12 15c1.66 0 3-1.31 3-2.97v-7.02c0-1.66-1.34-3.01-3-3.01s-3 1.34-3 3.01v7.02c0 1.66 1.34 2.97 3 2.97z"></path>
              <path fill="#0F6666" d="m11 18.08h2v3.92h-2z"></path>
              <path fill="#0F6666" d="m7.05 16.87c-1.27-1.33-2.05-2.83-2.05-4.87h2c0 1.45 0.56 2.42 1.47 3.38v0.32l-1.15 1.18z"></path>
              <path fill="#0F6666" d="m12 16.93a4.97 5.25 0 0 1 -3.54 -1.55l-1.41 1.49c1.26 1.34 3.02 2.13 4.95 2.13 3.87 0 6.99-2.92 6.99-7h-1.99c0 2.92-2.24 4.93-5 4.93z"></path>
            </svg>
          </div>
          <div class="camera-icon" title="Search by image">
            <svg focusable="false" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="24" height="24">
              <path fill="#0F6666" d="m14.13 17.46 2.66-4.62c.17-.29.05-.63-.25-.74-.1-.04-.21-.04-.31 0l-2.66 1.91-2.13-3.69c-.17-.29-.55-.38-.84-.21-.1.06-.17.15-.22.26l-2.37 4.11c-.17.29-.05.63.25.74.1.04.21.04.31 0l2.37-1.7 2.13 3.69c.17.29.55.38.84.21.1-.06.17-.15.22-.26z"></path>
              <circle cx="11.995" cy="12" fill="#0F6666" r="5.5"></circle>
              <path fill="#0F6666" d="m12 17.5c-3.04 0-5.5-2.46-5.5-5.5s2.46-5.5 5.5-5.5 5.5 2.46 5.5 5.5-2.46 5.5-5.5 5.5zm0-9c-1.93 0-3.5 1.57-3.5 3.5s1.57 3.5 3.5 3.5 3.5-1.57 3.5-3.5-1.57-3.5-3.5-3.5z"></path>
              <path fill="#0F6666" d="m3.5 7.5c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"></path>
              <path fill="#0F6666" d="m19.5 2.5h-15c-.83 0-1.5.67-1.5 1.5v15c0 .83.67 1.5 1.5 1.5h15c.83 0 1.5-.67 1.5-1.5v-15c0-.83-.67-1.5-1.5-1.5zm-15 17v-15h15l.0001 15h-15.0001z"></path>
            </svg>
          </div>
        </div>
      </div>
      <div class="nav-links">
        <a href="#" class="nav-link">Images</a>
        <div class="apps-icon" id="resultsMenuToggle">☰</div>
      </div>
    </div>
    
    <!-- Results Container -->
    <div class="results-container">
      <div class="results-info" id="resultsInfo">About 0 results (0 seconds)</div>
      <div id="resultsList">
        <!-- Results will be populated here -->
      </div>
      <div id="imagesResults" class="hidden">
        <!-- Pexels images will be populated here -->
      </div>
    </div>
  </div>
  
  <!-- Menu Modal -->
  <div class="menu-modal" id="menuModal">
    <div class="menu-header">
      <div class="menu-title">WEXAUR Mini Menu</div>
      <div class="menu-close" id="menuClose">✕</div>
    </div>
    
    <div class="menu-section">
      <div class="menu-section-title">Theme</div>
      <div class="theme-options">
        <div class="theme-option theme-light active" data-theme="light"></div>
        <div class="theme-option theme-dark" data-theme="dark"></div>
        <div class="theme-option theme-blue" data-theme="blue"></div>
        <div class="theme-option theme-teal" data-theme="teal"></div>
      </div>
    </div>
    
    <div class="menu-section">
      <div class="menu-section-title">Festival Mode</div>
      <div class="menu-item" id="festivalAuto">
        <div class="menu-item-icon">🎉</div>
        <div class="menu-item-text">Auto Detect Festivals</div>
      </div>
      <div class="menu-item" id="festivalOff">
        <div class="menu-item-icon">🔇</div>
        <div class="menu-item-text">Turn Off Festivals</div>
      </div>
    </div>
    
    <div class="menu-section">
      <div class="menu-section-title">About WEXAUR</div>
      <div class="menu-item">
        <div class="menu-item-icon">ℹ️</div>
        <div class="menu-item-text">What is WEXAUR?</div>
      </div>
      <div class="menu-item">
        <div class="menu-item-icon">🔍</div>
        <div class="menu-item-text">How Search Works</div>
      </div>
      <div class="menu-item">
        <div class="menu-item-icon">🛡️</div>
        <div class="menu-item-text">Privacy & Security</div>
      </div>
    </div>
    
    <div class="menu-section">
      <div class="menu-section-title">Settings</div>
      <div class="menu-item">
        <div class="menu-item-icon">🌐</div>
        <div class="menu-item-text">Search Language</div>
      </div>
      <div class="menu-item">
        <div class="menu-item-icon">🔔</div>
        <div class="menu-item-text">Notifications</div>
      </div>
      <div class="menu-item">
        <div class="menu-item-icon">📱</div>
        <div class="menu-item-text">Appearance</div>
      </div>
    </div>
  </div>

<script>
/* ====== USER KEYS ====== */
const API_KEY = "AIzaSyBJ5uSrX85HNdOYXUxMMRPIf-HuxfdjO_I";
const CX_ID  = "d4748f519323b4e51";
const PEXELS_API_KEY = "3s77Al0edMc4FXRBSfZ8DQjWwiTaoPTbjWNAeLOXWHAgkwzFExD4Ow6f";
/* ====== END KEYS ====== */

/* DOM Elements */
const homePage = document.getElementById('homePage');
const resultsPage = document.getElementById('resultsPage');
const searchInput = document.getElementById('searchInput');
const resultsSearchInput = document.getElementById('resultsSearchInput');
const searchBtn = document.getElementById('searchBtn');
const discoverGrid = document.getElementById('discoverGrid');
const resultsList = document.getElementById('resultsList');
const imagesResults = document.getElementById('imagesResults');
const resultsInfo = document.getElementById('resultsInfo');
const logoLarge = document.getElementById('logoLarge');
const menuModal = document.getElementById('menuModal');
const menuToggle = document.getElementById('menuToggle');
const resultsMenuToggle = document.getElementById('resultsMenuToggle');
const menuClose = document.getElementById('menuClose');
const voiceSearch = document.getElementById('voiceSearch');
const imageSearch = document.getElementById('imageSearch');
const backBtn = document.getElementById('backBtn');

/* Search State */
let currentSearchType = 'web';
let currentQuery = '';

/* Voice Search */
let recognition = null;
if ('webkitSpeechRecognition' in window) {
  recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = 'en-US';
}

/* Festival Detection and Animation */
let festivalMode = localStorage.getItem('wex_fest_mode') || 'auto';

function detectFestivalAuto(){
  const now = new Date();
  const m = now.getMonth(), d = now.getDate();
  // Diwali: Oct-Nov (month 9 or 10) - 19,20,21,22,23 Oct
  if((m === 9 && (d >= 19 && d <= 23)) || (m === 10 && d <= 5)) return 'diwali';
  // Christmas: Dec 25
  if(m === 11 && d === 25) return 'christmas';
  // New Year: Dec 31 / Jan 1
  if((m === 11 && d === 31) || (m === 0 && d === 1)) return 'newyear';
  return null;
}

function applyFestivalAnimation(){
  // Remove any existing animation classes
  logoLarge.classList.remove('diwali-animation', 'christmas-animation', 'newyear-animation');
  
  if(festivalMode === 'auto'){
    const festival = detectFestivalAuto();
    if(festival){
      logoLarge.classList.add(`${festival}-animation`);
    }
  } else if(festivalMode !== 'off'){
    logoLarge.classList.add(`${festivalMode}-animation`);
  }
}

// Apply festival animation on page load
applyFestivalAnimation();

/* Search Functionality */
function performSearch(query, searchType = currentSearchType){
  if(!query.trim()) return;
  
  currentQuery = query;
  
  // Switch to results page
  homePage.classList.add('hidden');
  resultsPage.classList.remove('hidden');
  
  // Set search query in results page
  resultsSearchInput.value = query;
  
  // Clear previous results
  clearResults();
  
  // Show loading message
  if (searchType === 'web') {
    resultsList.innerHTML = '<div style="padding:20px;text-align:center">Searching...</div>';
  } else if (searchType === 'images') {
    imagesResults.innerHTML = '<div style="padding:20px;text-align:center">Searching for images...</div>';
  }
  
  // Perform search based on type
  if (searchType === 'web') {
    cseSearch(query, 1, 10)
      .then(data => {
        displayWebResults(data);
      })
      .catch(error => {
        resultsList.innerHTML = `<div style="padding:20px;text-align:center">Search failed: ${error.message}</div>`;
      });
  } else if (searchType === 'images') {
    searchPexelsImages(query, 1, 20)
      .then(data => {
        displayImageResults(data);
      })
      .catch(error => {
        imagesResults.innerHTML = `<div style="padding:20px;text-align:center">Image search failed: ${error.message}</div>`;
      });
  }
}

function displayWebResults(data){
  clearResults();
  
  if(data.searchInformation){
    resultsInfo.textContent = `About ${data.searchInformation.formattedTotalResults || '0'} results (${data.searchInformation.formattedSearchTime || '0'} seconds)`;
  }
  
  if(Array.isArray(data.items) && data.items.length){
    data.items.forEach(item => {
      const resultItem = document.createElement('div');
      resultItem.className = 'result-item';
      
      const url = document.createElement('div');
      url.className = 'result-url';
      url.textContent = item.displayLink || '';
      
      const title = document.createElement('a');
      title.className = 'result-title';
      title.href = item.link;
      title.textContent = item.title || '';
      title.target = '_blank';
      
      const snippet = document.createElement('div');
      snippet.className = 'result-snippet';
      snippet.innerHTML = item.htmlSnippet || item.snippet || '';
      
      resultItem.appendChild(url);
      resultItem.appendChild(title);
      resultItem.appendChild(snippet);
      
      resultsList.appendChild(resultItem);
    });
  } else {
    resultsList.innerHTML = '<div style="padding:20px;text-align:center">No results found. Try different keywords.</div>';
  }
}

function displayImageResults(data){
  clearResults();
  
  if(data.total_results > 0){
    resultsInfo.textContent = `About ${data.total_results} image results`;
    
    // Show images grid
    imagesResults.classList.remove('hidden');
    resultsList.classList.add('hidden');
    
    // Create images grid
    const imagesGrid = document.createElement('div');
    imagesGrid.className = 'images-grid';
    
    data.photos.forEach(photo => {
      const imageCard = document.createElement('div');
      imageCard.className = 'image-card';
      
      imageCard.innerHTML = `
        <img src="${photo.src.medium}" alt="${photo.alt || 'Pexels Image'}" loading="lazy">
        <div class="image-info">
          <div class="image-photographer">Photo by ${photo.photographer}</div>
          <a href="${photo.src.original}" class="image-download" target="_blank" download>Download</a>
        </div>
      `;
      
      imagesGrid.appendChild(imageCard);
    });
    
    imagesResults.innerHTML = '';
    imagesResults.appendChild(imagesGrid);
  } else {
    imagesResults.innerHTML = '<div style="padding:20px;text-align:center">No images found. Try different keywords.</div>';
  }
}

function clearResults(){
  resultsList.innerHTML = '';
  imagesResults.innerHTML = '';
  resultsInfo.textContent = '';
  imagesResults.classList.add('hidden');
  resultsList.classList.remove('hidden');
}

/* Pexels API Integration */
async function searchPexelsImages(query, page = 1, per_page = 20) {
  const url = `https://api.pexels.com/v1/search?query=${encodeURIComponent(query)}&page=${page}&per_page=${per_page}`;
  
  try {
    const response = await fetch(url, {
      headers: {
        'Authorization': PEXELS_API_KEY
      }
    });
    
    if (!response.ok) {
      throw new Error(`Pexels API error: ${response.status}`);
    }
    
    return await response.json();
  } catch (error) {
    console.error('Pexels search failed:', error);
    throw error;
  }
}

/* Search Tab Functionality */
function setupSearchTabs() {
  const searchOptions = document.querySelectorAll('.search-option');
  
  searchOptions.forEach(option => {
    option.addEventListener('click', function() {
      // Update active tab
      searchOptions.forEach(opt => {
        opt.classList.remove('active');
      });
      this.classList.add('active');
      
      // Set current search type
      currentSearchType = this.getAttribute('data-type');
      
      // Update search placeholder based on type
      if (currentSearchType === 'images') {
        searchInput.placeholder = 'Search for free high-quality images';
      } else {
        searchInput.placeholder = 'Search the web or type a URL';
      }
    });
  });
}

/* Event Listeners */
searchBtn.addEventListener('click', () => {
  performSearch(searchInput.value);
});

searchInput.addEventListener('keypress', (e) => {
  if(e.key === 'Enter') {
    performSearch(searchInput.value);
  }
});

resultsSearchInput.addEventListener('keypress', (e) => {
  if(e.key === 'Enter') {
    performSearch(resultsSearchInput.value);
  }
});

// Back button functionality - Fixed to return to previous state
backBtn.addEventListener('click', () => {
  // Store current scroll position before navigating back
  sessionStorage.setItem('wex_scrollPos', window.scrollY);
  
  // Navigate back to home page
  resultsPage.classList.add('hidden');
  homePage.classList.remove('hidden');
  
  // Restore focus to search input
  searchInput.focus();
});

// Handle browser back button - Fixed to return to previous state
window.addEventListener('popstate', function(event) {
  if(resultsPage.classList.contains('hidden') === false) {
    // Store current scroll position
    sessionStorage.setItem('wex_scrollPos', window.scrollY);
    
    // Navigate back to home page
    resultsPage.classList.add('hidden');
    homePage.classList.remove('hidden');
    
    // Restore focus to search input
    searchInput.focus();
  }
});

// Menu functionality
menuToggle.addEventListener('click', () => {
  menuModal.classList.add('open');
});

resultsMenuToggle.addEventListener('click', () => {
  menuModal.classList.add('open');
});

menuClose.addEventListener('click', () => {
  menuModal.classList.remove('open');
});

// Voice search implementation
voiceSearch.addEventListener('click', () => {
  if (!recognition) {
    alert('Voice search is not supported in your browser. Try Chrome or Edge.');
    return;
  }
  
  recognition.start();
  searchInput.placeholder = 'Listening...';
  
  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    searchInput.value = transcript;
    searchInput.placeholder = 'Search the web or type a URL';
    performSearch(transcript);
  };
  
  recognition.onerror = function(event) {
    searchInput.placeholder = 'Search the web or type a URL';
    alert('Error occurred in recognition: ' + event.error);
  };
  
  recognition.onend = function() {
    searchInput.placeholder = 'Search the web or type a URL';
  };
});

// Image search (placeholder with file upload)
imageSearch.addEventListener('click', () => {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.onchange = function(event) {
    const file = event.target.files[0];
    if (file) {
      alert('Pexels image search integration:\n\nIn a full implementation, this would:\n1. Upload image to Pexels API for reverse search\n2. Show visually similar images\n3. Allow downloading high-quality free images');
      // Here you would typically:
      // 1. Upload the image to Pexels API for reverse search
      // 2. Get search results based on image content
      // 3. Display visual search results
    }
  };
  input.click();
});

// Theme selection
document.querySelectorAll('.theme-option').forEach(option => {
  option.addEventListener('click', function() {
    document.querySelectorAll('.theme-option').forEach(opt => {
      opt.classList.remove('active');
    });
    this.classList.add('active');
    
    const theme = this.getAttribute('data-theme');
    // In a real implementation, you would change the CSS variables based on theme
    alert(`Theme changed to ${theme}. Full implementation would change CSS variables.`);
  });
});

// Festival mode selection
document.getElementById('festivalAuto').addEventListener('click', () => {
  festivalMode = 'auto';
  localStorage.setItem('wex_fest_mode', 'auto');
  applyFestivalAnimation();
  menuModal.classList.remove('open');
  alert('Festival mode set to Auto');
});

document.getElementById('festivalOff').addEventListener('click', () => {
  festivalMode = 'off';
  localStorage.setItem('wex_fest_mode', 'off');
  applyFestivalAnimation();
  menuModal.classList.remove('open');
  alert('Festival mode turned off');
});

/* Google CSE API Function */
async function cseSearch(query, start=1, num=10) {
  const url = `https://www.googleapis.com/customsearch/v1?key=${encodeURIComponent(API_KEY)}&cx=${encodeURIComponent(CX_ID)}&q=${encodeURIComponent(query)}&start=${start}&num=${num}`;
  const r = await fetch(url);
  if(!r.ok){
    const text = await r.text();
    throw new Error('CSE API error: '+r.status+' '+text);
  }
  return await r.json();
}

/* Discover Section - Load Real Daily News */
const DAILY_NEWS_QUERIES = [
  { 
    title: 'Top Headlines', 
    q: 'breaking news today india', 
    image: 'https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=400&h=200&fit=crop&auto=format'
  },
  { 
    title: 'Technology', 
    q: 'latest tech news 2024', 
    image: 'https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=400&h=200&fit=crop&auto=format'
  },
  { 
    title: 'Sports', 
    q: 'sports news today cricket football', 
    image: 'https://images.unsplash.com/photo-1461896836934-ffe607ba8211?w=400&h=200&fit=crop&auto=format'
  },
  { 
    title: 'Entertainment', 
    q: 'bollywood hollywood news today', 
    image: 'https://images.unsplash.com/photo-1489599809505-f2fbe5d6f8c1?w=400&h=200&fit=crop&auto=format'
  },
  { 
    title: 'Business', 
    q: 'business news stock market today', 
    image: 'https://images.unsplash.com/photo-1507679799987-c73779587ccf?w=400&h=200&fit=crop&auto=format'
  },
  { 
    title: 'Health', 
    q: 'health news fitness tips today', 
    image: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=200&fit=crop&auto=format'
  }
];

async function loadDiscover(){
  discoverGrid.innerHTML = '';
  
  for(const category of DAILY_NEWS_QUERIES){
    try{
      const data = await cseSearch(category.q, 1, 1);
      const item = data.items && data.items[0] ? data.items[0] : null;
      
      const card = document.createElement('div');
      card.className = 'discover-card';
      
      if(item){
        card.innerHTML = `
          <img src="${category.image}" alt="${escapeHtml(category.title)}" class="discover-card-image" onerror="this.style.display='none'">
          <div class="discover-card-content">
            <div class="discover-card-title">${escapeHtml(category.title)}</div>
            <div class="discover-card-desc">${escapeHtml((item.snippet || 'Latest updates in this category').substring(0, 80))}...</div>
            <div class="discover-card-source">${escapeHtml(item.displayLink || 'News Source')}</div>
          </div>
        `;
        
        card.addEventListener('click', () => {
          window.open(item.link, '_blank');
        });
      } else {
        card.innerHTML = `
          <img src="${category.image}" alt="${escapeHtml(category.title)}" class="discover-card-image">
          <div class="discover-card-content">
            <div class="discover-card-title">${escapeHtml(category.title)}</div>
            <div class="discover-card-desc">Stay updated with latest news in this category</div>
          </div>
        `;
      }
      
      discoverGrid.appendChild(card);
    } catch(error) {
      const card = document.createElement('div');
      card.className = 'discover-card';
      card.innerHTML = `
        <img src="${category.image}" alt="${escapeHtml(category.title)}" class="discover-card-image">
        <div class="discover-card-content">
          <div class="discover-card-title">${escapeHtml(category.title)}</div>
          <div class="discover-card-desc">Latest news and updates</div>
        </div>
      `;
      discoverGrid.appendChild(card);
    }
  }
}

// Initialize search tabs
setupSearchTabs();

// Load discover content when page loads
loadDiscover();

/* Utility Functions */
function escapeHtml(s){ 
  return (s||'').toString().replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); 
}

// Restore scroll position when returning to results
window.addEventListener('load', function() {
  const scrollPos = sessionStorage.getItem('wex_scrollPos');
  if (scrollPos) {
    window.scrollTo(0, parseInt(scrollPos));
    sessionStorage.removeItem('wex_scrollPos');
  }
});

// Simple PWA functionality
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('/sw.js').catch(() => {});
}
</script>
</body>
</html>